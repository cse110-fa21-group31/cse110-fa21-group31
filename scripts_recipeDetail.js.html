<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/recipeDetail.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/recipeDetail.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// import RecipeClass from "./recipeClass";

// RecipeExpand.js
window.addEventListener("DOMContentLoaded", init);

const recipes = [
    "https://introweb.tech/assets/json/ghostCookies.json",
    "https://introweb.tech/assets/json/birthdayCake.json",
    "https://introweb.tech/assets/json/chocolateChip.json",
    "https://introweb.tech/assets/json/stuffing.json",
    "https://introweb.tech/assets/json/turkey.json",
    "https://introweb.tech/assets/json/pumpkinPie.json",
];
const recipeData = {};
async function fetchRecipes() {
    return new Promise((resolve, reject) => {
        recipes.forEach((recipe) => {
            fetch(recipe)
                .then((response) => response.json())
                .then((data) => {
                    // This grabs the page name from the URL in the array above
                    data["page-name"] = recipe.split("/").pop().split(".")[0];
                    recipeData[recipe] = data;
                    if (Object.keys(recipeData).length == recipes.length) {
                        resolve();
                    }
                })
                .catch((err) => {
                    console.log(`Error loading the ${recipe} recipe`);
                    reject(err);
                });
        });
    });
}

async function init() {
    try {
        await fetchRecipes();
    } catch (err) {
        console.log(`Error fetching recipes: ${err}`);
        return;
    }
    const data = recipeData[recipes[0]];
    fillOutRecipe(data);
}

function fillOutRecipe(data) {
    console.log(getTitle(data));
    console.log(getYield(data));
    console.log(getCategories(data));
    console.log(getDescription(data));
    console.log(getImage(data));
    console.log(getOrganization(data));
    console.log(getIngredients(data));
    console.log(getInstructions(data));
    document.getElementById("recipeTitle").innerHTML = getTitle(data);
    //document.getElementById("tags").innerHTML=getCategories(data);
    document.getElementById("recipeImage").setAttribute("src", getImage(data));
    document.getElementById("description").innerHTML = getDescription(data);
    document.getElementById("servingSize").innerHTML = getYield(data);
    document.getElementById("author").innerHTML = getOrganization(data);
    document.getElementById("cookTime").innerHTML = convertTime(
        searchForKey(data, "totalTime")
    );
    document.getElementById("dateOfCreation").innerHTML = searchForKey(
        data,
        "datePublished"
    ).split("T")[0];

    const tagss = getCategories(data).split(",");
    tagss.forEach((tag) => {
        const listItem = document.createElement("li");
        listItem.innerHTML = tag;
        document.getElementById("tags").append(listItem);
    });

    const ingredients = getIngredients(data);
    ingredients.forEach((ingredient) => {
        const listItem = document.createElement("li");
        listItem.innerHTML = ingredient;
        document.getElementById("ingredients").append(listItem);
    });

    const instructions = getInstructions(data);
    instructions.forEach((instruction) => {
        const listItem = document.createElement("li");
        listItem.innerHTML = instruction;
        document.getElementById("steps").append(listItem);
    });
}

// Getters from lab

/**
 * Recursively search for a key nested somewhere inside an object
 * @param {Object} object the object with which you'd like to search
 * @param {String} key the key that you are looking for in the object
 * @returns {*} the value of the found key
 */
function searchForKey(object, key) {
    var value;
    Object.keys(object).some(function (k) {
        if (k === key) {
            value = object[k];
            return true;
        }
        if (object[k] &amp;&amp; typeof object[k] === "object") {
            value = searchForKey(object[k], key);
            return value !== undefined;
        }
    });
    return value;
}

/**
 * Extract the title of the recipe from the given recipe schema JSON obejct
 * @param {Object} data Raw recipe JSON to find the image of
 * @returns {String} If found, returns the recipe title
 */
function getTitle(data) {
    if (data.name) return data.name;
    if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "Recipe") {
                if (data["@graph"][i]["name"]) return data["@graph"][i]["name"];
            }
        }
    }
    return null;
}

/**
 * Extract the yield of the recipe from the given recipe schema JSON obejct
 * @param {Object} data Raw recipe JSON to find the image of
 * @returns {String} If found, returns the recipe yield
 */
function getYield(data) {
    if (data.recipeYield) return data.recipeYield;
    if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "Recipe") {
                if (data["@graph"][i]["recipeYield"]) {
                    if (Array.isArray(data["@graph"][i]["recipeYield"])) {
                        return data["@graph"][i]["recipeYield"][0];
                    } else if (
                        typeof data["@graph"][i]["recipeYield"] == "string"
                    ) {
                        return data["@graph"][i]["recipeYield"];
                    }
                }
            }
        }
    }
    return null;
}

/**
 * Extract the categories of the recipe from the given recipe schema JSON obejct
 * @param {Object} data Raw recipe JSON to find the image of
 * @returns {String} If found, returns the recipe categories as a string
 */
function getCategories(data) {
    let categories = null;
    if (data.recipeCategory) {
        categories = data.recipeCategory;
    } else if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "Recipe") {
                if (data["@graph"][i]["recipeCategory"]) {
                    categories = data["@graph"][i]["recipeCategory"];
                }
            }
        }
    }
    if (Array.isArray(categories)) categories = categories.join(", ");
    return categories.toLowerCase();
}

/**
 * Extract the description of the recipe from the given recipe schema JSON obejct
 * @param {Object} data Raw recipe JSON to find the image of
 * @returns {String} If found, returns the recipe description
 */
function getDescription(data) {
    if (data.description) return data.description;
    if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "Recipe") {
                return data["@graph"][i]["description"];
            }
        }
    }
    return null;
}

/**
 * Extract a usable image from the given recipe schema JSON object
 * @param {Object} data Raw recipe JSON to find the image of
 * @returns {String} If found, returns the URL of the image as a string, otherwise null
 */
function getImage(data) {
    if (data.image?.url) return data.image.url;
    if (data.image?.contentUrl) return data.image.contentUrl;
    if (data.image?.thumbnail) return data.image.thumbnail;
    if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "ImageObject") {
                if (data["@graph"][i]["url"]) return data["@graph"][i]["url"];
                if (data["@graph"][i]["contentUrl"])
                    return data["@graph"][i]["contentUrl"];
                if (data["@graph"][i]["thumbnailUrl"])
                    return data["@graph"][i]["thumbnailUrl"];
            }
        }
    }
    return null;
}

/**
 * Extract the URL from the given recipe schema JSON object
 * @param {Object} data Raw recipe JSON to find the URL of
 * @returns {String} If found, it returns the URL as a string, otherwise null
 */
/* eslint-disable no-unused-vars*/
function getUrl(data) {
    if (data.url) return data.url;
    if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "Recipe")
                return data["@graph"][i]["@id"];
        }
    }
    return null;
}
/* eslint-enable no-unused-vars*/

/**
 * Similar to getUrl(), this function extracts the organizations name from the
 * schema JSON object. It's not in a standard location so this function helps.
 * @param {Object} data Raw recipe JSON to find the org string of
 * @returns {String} If found, it retuns the name of the org as a string, otherwise null
 */
function getOrganization(data) {
    if (data.publisher?.name) return data.publisher?.name;
    if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "WebSite") {
                return data["@graph"][i].name;
            }
        }
    }
    return null;
}

/**
 * Converts ISO 8061 time strings to regular english time strings.
 * Not perfect but it works for this lab
 * @param {String} time time string to format
 * @return {String} formatted time string
 */
function convertTime(time) {
    let timeStr = "";

    // Remove the 'PT'
    time = time.slice(2);

    let timeArr = time.split("");
    if (time.includes("H")) {
        for (let i = 0; i &lt; timeArr.length; i++) {
            if (timeArr[i] == "H") return `${timeStr} hr`;
            timeStr += timeArr[i];
        }
    } else {
        for (let i = 0; i &lt; timeArr.length; i++) {
            if (timeArr[i] == "M") return `${timeStr} min`;
            timeStr += timeArr[i];
        }
    }

    return "";
}

/**
 * Extract the ingredients of the recipe from the given recipe schema JSON obejct
 * @param {Object} data Raw recipe JSON to find the image of
 * @returns {Array} If found, returns the recipe ingredients
 */
function getIngredients(data) {
    if (data.recipeIngredient) {
        if (typeof data.recipeIngredient == "string") {
            return data.recipeIngredient.slit(". ");
        }
        return data.recipeIngredient;
    }
    if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "Recipe") {
                if (typeof data["@graph"][i]["recipeIngredient"] == "string") {
                    return data["@graph"][i]["recipeIngredient"].slit(". ");
                }
                return data["@graph"][i]["recipeIngredient"];
            }
        }
    }
    return null;
}

/**
 * Extract the instructions of the recipe from the given recipe schema JSON obejct.
 * This ones a bit messy and optimally should be refactored but it works.
 * @param {Object} data Raw recipe JSON to find the image of
 * @returns {Array} If found, returns the recipe instructions
 */
function getInstructions(data) {
    if (data.recipeInstructions) {
        if (typeof data.recipeInstructions == "string") {
            return data.recipeInstructions.split(". ");
        }
        return data.recipeInstructions;
    }
    if (data["@graph"]) {
        for (let i = 0; i &lt; data["@graph"].length; i++) {
            if (data["@graph"][i]["@type"] == "Recipe") {
                if (data["@graph"][i]["recipeInstructions"] == "string") {
                    return data["@graph"][i]["recipeInstructions"].split(". ");
                }
                if (
                    data["@graph"][i]["recipeInstructions"][0][
                        "itemListElement"
                    ]
                ) {
                    const instructionArr = [];
                    data["@graph"][i]["recipeInstructions"].forEach(
                        (instrObj) => {
                            instrObj.itemListElement.forEach((instruction) => {
                                instructionArr.push(instruction.text);
                            });
                        }
                    );
                    return instructionArr;
                } else {
                    return data["@graph"][i]["recipeInstructions"].map(
                        (instr) => instr.text
                    );
                }
            }
        }
    }
    return null;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#convertTime">convertTime</a></li><li><a href="global.html#createNewUser">createNewUser</a></li><li><a href="global.html#getCategories">getCategories</a></li><li><a href="global.html#getDescription">getDescription</a></li><li><a href="global.html#getHelloWorld">getHelloWorld</a></li><li><a href="global.html#getImage">getImage</a></li><li><a href="global.html#getIngredients">getIngredients</a></li><li><a href="global.html#getInstructions">getInstructions</a></li><li><a href="global.html#getOrganization">getOrganization</a></li><li><a href="global.html#getTitle">getTitle</a></li><li><a href="global.html#getYield">getYield</a></li><li><a href="global.html#hasUser">hasUser</a></li><li><a href="global.html#onSignIn">onSignIn</a></li><li><a href="global.html#searchForKey">searchForKey</a></li><li><a href="global.html#signOut">signOut</a></li><li><a href="global.html#userSignedOut">userSignedOut</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Nov 21 2021 19:22:17 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
