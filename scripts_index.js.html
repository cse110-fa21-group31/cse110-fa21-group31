<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// import RecipeClass from "./recipeClass";
// The purpose of this JS file is to take API JSON files, create recipeClass objects with that info, and "send" them out to the website
export default {
    createRecipeCards, redirectRecipeDetail, bindRecipeCard,
    routerAddCreatePage, routerAddEditPage, routerNavigateWrapper,
    bindUserProfile, bindEscKey, bindPopstate, setGlobalUserData, clearGlobalUserData
}
// RecipeExpand.js
if (typeof window !== "undefined") {
    window.addEventListener("DOMContentLoaded", init);

}


// THESE SHOULD BE GIVEN VIA API
import { Router } from './router/Router.js'
import { ELE_ID_PROFILE_WRAPPER, RECIPE_ROUTE, USER_ROUTE, HOME_ROUTER } from './util.js'
import { fillOutRecipe } from './recipeDetail.js'
import { setupCreatePage } from './createPage.js'
import { populateEditPage } from './editPage.js'
import { setupDisqusScript } from './disqus.js';
import { initialRecipeCards } from './indexSearch.js';
var recipeData = [];
export var userData = null;

let homePage = null; // = document.getElementById('homePage')
let recipeDetailPage = null; // = document.getElementById('recipeDetail')
let userInfoPage = null; // = document.getElementById('userInfo')
let createRecipePage = null; // = document.getElementById('createRecipe')
let editRecipePage = null; // = document.getElementById('editRecipe')
let landingPage = null; // = document.getElementById('landingPage')

if (typeof window === 'object') {
    if (typeof window.document === 'object') {
        homePage = document.getElementById('homePage');
        recipeDetailPage = document.getElementById('recipeDetail');
        userInfoPage = document.getElementById('userInfo');
        createRecipePage = document.getElementById('createRecipe');
        editRecipePage = document.getElementById('editRecipe');
        landingPage = document.getElementById('landingPage');
    }
}




export const router = new Router(function () {
    // console.log("Test router");
    // TODO: array and for loop in the future
    landingPage.classList.add("shown");
    homePage.classList.remove("shown");
    recipeDetailPage.classList.remove("shown");
    userInfoPage.classList.remove("shown");
    createRecipePage.classList.remove("shown");
    editRecipePage.classList.remove("shown");
    initialRecipeCards();
});

async function init() {
    initialRecipeCards();
    bindEscKey();
    bindPopstate();
    homePageButton();
}

function homePageButton() {
    let but = document.getElementsByClassName('logo')[0];
    but.addEventListener('click', () => {
        routerNavigateWrapper(HOME_ROUTER);
    })
}

// the jankiest solution to ever exist (sorry)
// any suggestion to make this better or placed somewhere else is welcome
let observedMutationEvent = new Event('observedMutation')
let observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        if (!mutation.addedNodes) return;
        // something was added
        document.dispatchEvent(observedMutationEvent);
    });
});

const waitForSelector = (selectorStr) => {
    // Use the previously defined observer to watch for the selectorStr to return something not null
    return new Promise((resolve, reject) => {
        const element = document.querySelector(selectorStr);
        if (element) {
            resolve(element);
        } else {
            document.addEventListener('observedMutation', () => {
                const element = document.querySelector(selectorStr);
                if (element) {
                    resolve(element);
                }
            });
        }
    });
}

observer.observe(document.body, {
    childList: true,
    subtree: true,
    attributes: false,
    characterData: false,
});

/**
 * Generates the &lt;recipeCard> elements from the fetched recipes and
 * appends them to the page
 */
export function createRecipeCards(recipes, container) {
    let containerName = container
    if (!containerName) containerName = '.myRecipeCardGridContainer'
    // console.log(container)
    let newRecipes = recipeData;
    if (recipes) {
        newRecipes = recipes;
    }
    // Makes new recipe cards
    // Wait until the gridContainer is loaded
    waitForSelector(containerName)
        .then(gridContainer => {
            while (gridContainer.firstChild) {
                gridContainer.removeChild(gridContainer.firstChild);
            }
            newRecipes.forEach(recipeObj => {
                if (!recipeObj) return
                //create the recipe card
                const recipeCard = document.createElement('recipe-card');
                recipeCard.data = recipeObj
                //create the recipeDetail page for this card and linked it to the router
                redirectRecipeDetail(recipeObj)
                // click event
                const page = recipeObj._id;
                const routeUrl = RECIPE_ROUTE + page
                //when this card is clicked, redirect to the recipeDetail page
                recipeCard.addEventListener('click', e => {
                    // if (e.path[0].nodeName == 'A') return;
                    router.navigate(routeUrl);
                    const disqusScript = document.getElementById('disqus_script');
                    disqusScript.onload = setupDisqusScript(recipeObj._id)
                });
                gridContainer.appendChild(recipeCard);
            })
        });
}

/**
 * Adds the function in Router that redirects to recipeDetail
 * @param recipeObj The object of the created recipe. 
 */
export function redirectRecipeDetail(recipeObj) {
    const page = recipeObj._id;
    const routeUrl = RECIPE_ROUTE + page
    router.addPage(routeUrl, function () {
        homePage.classList.remove("shown");
        recipeDetailPage.classList.add("shown");
        userInfoPage.classList.remove("shown");
        createRecipePage.classList.remove("shown");
        editRecipePage.classList.remove("shown");
        landingPage.classList.remove("shown");
        recipeDetailPage.data = recipeObj;
        // console.log(recipeDetailPage.data)
        fillOutRecipe(recipeObj)
        // const disqusScript = document.getElementById('disqus_script');
        // disqusScript.onload = setupDisqusScript(recipeObj._id)
    });
}
/**
 * Binds the click event listener to the &lt;recipe-card> elements added to the page
 * so that when they are clicked, their card expands into the full recipe view mode
 * @param {Element} recipeCard the &lt;recipe-card> element you wish to bind the event
 *                             listeners to
 * @param {String} pageName the name of the page to navigate to on click
 */
export function bindRecipeCard(recipeCard, pageName) {
    recipeCard.addEventListener('click', e => {
        if (e.path[0].nodeName == 'A') return;
        router.navigate(pageName);
    });
}

/**
 * 
 * @param {*} pageName 
 * @param {*} callback function
 */
export function routerAddCreatePage(pageName, recipeObj, isUpdate) {
    if (isUpdate) {
        router.addPage(pageName, function () {
            homePage.classList.remove("shown");
            recipeDetailPage.classList.remove("shown");
            userInfoPage.classList.remove("shown");
            createRecipePage.classList.remove("shown");
            editRecipePage.classList.add("shown");
            landingPage.classList.remove("shown");
            populateEditPage(recipeObj)
        })
    }
    else router.addPage(pageName, function () {
        homePage.classList.remove("shown");
        recipeDetailPage.classList.remove("shown");
        userInfoPage.classList.remove("shown");
        createRecipePage.classList.add("shown");
        editRecipePage.classList.remove("shown");
        landingPage.classList.remove("shown");
        setupCreatePage()
    })
}

/**
 * 
 * @param {*} pageName 
 * @param {*} callback function
 */
export function routerAddEditPage(pageName, recipeObj) {
    router.addPage(pageName, function () {
        homePage.classList.remove("shown");
        recipeDetailPage.classList.remove("shown");
        userInfoPage.classList.remove("shown");
        createRecipePage.classList.remove("shown");
        landingPage.classList.remove("shown");
        editRecipePage.classList.add("shown");

        populateEditPage(recipeObj)
    })
}

export function routerNavigateWrapper(pageName) {
    router.navigate(pageName);
}
/**
 * Binds the click event listener to the &lt;profileWrapper> elements added to the page
 * so that when they are clicked, their card expands into the full recipe view mode
 * @param {Element} profile the user profile json file
 */
export async function bindUserProfile(profile) {
    const pageName = USER_ROUTE + profile._id
    router.addPage(pageName, function () {
        homePage.classList.remove("shown");
        recipeDetailPage.classList.remove("shown");
        createRecipePage.classList.remove("shown");
        editRecipePage.classList.remove("shown");
        landingPage.classList.remove("shown");
        userInfoPage.classList.add("shown");
        userInfoPage.data = profile
        // Important: we need profile.myRecipe and profile.savedRecipe as an array of recipe OBJECT
        document.getElementById("userName").textContent = profile.username ? profile.username : "OliveU User"
        document.getElementById("userEmail").textContent = profile.email ? profile.email : "OliveU Email"

        if (profile.myRecipe) {
            createRecipeCards(profile.myRecipe, ".myUploadRecipeCardGridContainer")
        }
        if (profile.savedRecipe) {
            createRecipeCards(profile.savedRecipe, ".mySavedRecipeCardGridContainer")
        }
    });

    const profileButton = document.getElementById(ELE_ID_PROFILE_WRAPPER)
    profileButton.addEventListener('click', e => {
        if (e.path[0].nodeName == 'A') return;
        router.navigate(pageName);
    });
}

/**
 * Binds the 'keydown' event listener to the Escape key (esc) such that when
 * it is clicked, the home page is returned to
 */
export function bindEscKey() {
    document.addEventListener('keydown', function (e) {
        if (e.key == "Escape") {
            router.navigate("home", false);
        }
    });
}

/**
 * Binds the 'popstate' event on the window (which fires when the back &amp;
 * forward buttons are pressed) so the navigation will continue to work 
 * as expected. 
 */
export function bindPopstate() {
    window.addEventListener('popstate', (event) => {
        if (event.state) {
            router.navigate(event.state.pageName, true);
        } else {
            router.navigate('home', true);
        }
    });
}


/**
 * Save profile to global variable userData in index.js.
 * @param profile The json file of the user data
 */
export function setGlobalUserData(profile) {
    userData = profile;
}

/**
 * Clear global variable userData in index.js.
 */
export function clearGlobalUserData() {
    userData = null;
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Router_Router.html">Router</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bindEscKey">bindEscKey</a></li><li><a href="global.html#bindPopstate">bindPopstate</a></li><li><a href="global.html#bindRecipeCard">bindRecipeCard</a></li><li><a href="global.html#bindUserProfile">bindUserProfile</a></li><li><a href="global.html#clearGlobalUserData">clearGlobalUserData</a></li><li><a href="global.html#createNewUser">createNewUser</a></li><li><a href="global.html#createNodeClone">createNodeClone</a></li><li><a href="global.html#createRecipeCards">createRecipeCards</a></li><li><a href="global.html#deleteRecipe">deleteRecipe</a></li><li><a href="global.html#fetchRecipeById">fetchRecipeById</a></li><li><a href="global.html#fetchRecipeByPage">fetchRecipeByPage</a></li><li><a href="global.html#fetchRecipesByIds">fetchRecipesByIds</a></li><li><a href="global.html#fetchUserById">fetchUserById</a></li><li><a href="global.html#getAuthor">getAuthor</a></li><li><a href="global.html#getDescription">getDescription</a></li><li><a href="global.html#getImage">getImage</a></li><li><a href="global.html#getIngredients">getIngredients</a></li><li><a href="global.html#getName">getName</a></li><li><a href="global.html#getSteps">getSteps</a></li><li><a href="global.html#getTags">getTags</a></li><li><a href="global.html#getUserData">getUserData</a></li><li><a href="global.html#hasUser">hasUser</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initialRecipeCards">initialRecipeCards</a></li><li><a href="global.html#insertRecipe">insertRecipe</a></li><li><a href="global.html#onSignIn">onSignIn</a></li><li><a href="global.html#onUpdateRecipe">onUpdateRecipe</a></li><li><a href="global.html#populateUserInfoPage">populateUserInfoPage</a></li><li><a href="global.html#redirectRecipeDetail">redirectRecipeDetail</a></li><li><a href="global.html#routerAddCreatePage">routerAddCreatePage</a></li><li><a href="global.html#routerAddEditPage">routerAddEditPage</a></li><li><a href="global.html#searchForKey">searchForKey</a></li><li><a href="global.html#setGlobalUserData">setGlobalUserData</a></li><li><a href="global.html#setupDisqusScript">setupDisqusScript</a></li><li><a href="global.html#signOut">signOut</a></li><li><a href="global.html#submitInitialSearch">submitInitialSearch</a></li><li><a href="global.html#submitSearch">submitSearch</a></li><li><a href="global.html#updateRecipeById">updateRecipeById</a></li><li><a href="global.html#uploadImage">uploadImage</a></li><li><a href="global.html#userSignedOut">userSignedOut</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Wed Dec 08 2021 02:46:48 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
