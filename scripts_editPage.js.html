<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/editPage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/editPage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { updateRecipeById } from "./APICalls.js"
import { redirectRecipeDetail, routerNavigateWrapper, userData } from "./index.js";
import { createNodeClone, HOME_ROUTER, RECIPE_ROUTE } from './util.js'
let imageSrc = ''
let recipeId;
export default { populateEditPage }
export function populateEditPage(recipeObj) {
    recipeId = recipeObj._id;

    fillOutEditPage(recipeObj);
    createNodeClone('editCancel');
    const cancelBtn = document.getElementById("editCancel")
    cancelBtn.addEventListener('click', () => {

        routerNavigateWrapper(HOME_ROUTER)
    })
    // Adding steps to the recipe
    /* eslint-disable no-unused-vars*/
    const addStepButton = document.querySelector("#addSteps button");
    /* eslint-enable no-unused-vars*/
    //addStepButton.addEventListener('click', appendRow);

    // Submitting the entire recipe

    const recipeForm = document.getElementById("editRecipeForm");
    recipeForm.onsubmit = onUpdateRecipe;
    if (document.querySelector("#editRecipeForm #addIngr").getAttribute('listener') !== 'true') {
        document.querySelector("#editRecipeForm #addIngr").setAttribute('listener', 'true');
        createNodeClone('#editRecipeForm #addIngr', true);
        document.querySelector("#editRecipeForm #addIngr").addEventListener("click", function () {
            appendIngredient();
        });
        createNodeClone('#editRecipeForm #addStep', true);
        document.querySelector("#editRecipeForm #addStep").addEventListener("click", function () {
            appendStep();
        });
        createNodeClone('#editRecipeForm #delIngr', true);
        document.querySelector("#editRecipeForm #delIngr").addEventListener("click", function () {
            deleteIngredient();
        });
        createNodeClone('#editRecipeForm #delStep', true);
        document.querySelector("#editRecipeForm #delStep").addEventListener("click", function () {
            deleteStep();
        });
    }
}

export const deleteRecipeButton = async (event) => {
    // await deleteRecipe(pageId);
}


let numSteps = 0;
let numIngredients = 0;

export const fillOutEditPage = (recipeObj) => {

    console.log("EDITTED RECIPE");

    // get recipe info and fill it out
    // let response = await fetchRecipeById(recipeId);
    //TODO: update the variable from response to recipeObj
    let response = recipeObj
    console.log(response);
    // get ingredients from data
    document.getElementById('editName').innerHTML = '&lt;label for="name">Recipe Name: *&lt;/label>&lt;input type="text" name="name" id="name" value="' + response.name + '" placeholder="A creative name" required>';
    //document.getElementById('picture').innerHTML = 'label for="picture">Picture:&lt;/label>&lt;input type="file" name="picture" id="picture" src="'+response.image+'">';
    document.getElementById('editDescription').innerHTML = '&lt;label for="description">Description:&lt;/label>&lt;textarea name="description" id="descriptionText" placeholder="Tell us about your recipe!">' + response.description + ' &lt;/textarea>';


    document.getElementById('editTags').innerHTML = '&lt;label for="tags">Tags:&lt;/label>&lt;input type="text" name="tags" id="tags" value="' + response.tags.join(", ") + '" placeholder="tag1, tag2, tag3">';

    document.getElementById('editCookTime').innerHTML = '&lt;label for="cookTime">Cook Time:&lt;/label>&lt;input type="text" name="cookTime" id="prepTime" value="' + response.cookTime + '" placeholder="x hours">';

    document.getElementById('editServingSize').innerHTML = '&lt;label for="servingSize">Serving Size:&lt;/label>&lt;input type="text" name="servingSize" id="servingSize" value="' + response.servingSize + '" placeholder="x people">';

    //document.getElementById('difficulty').innerHTML = '&lt;label for="difficulty">Difficulty:&lt;/label>&lt;select name="difficulty" id="difficulty">&lt;option value="1">1 star&lt;/option>&lt;option value="2">2 stars&lt;/option>&lt;option value="3">3 stars&lt;/option>&lt;option value="4">4 stars&lt;/option>&lt;option value="5">5 stars&lt;/option>&lt;/select>';
    let diff = response.difficulty.charAt(0);
    if (diff == '1') {
        document.getElementById('editDifficulty').innerHTML = '&lt;label for="difficulty">Difficulty:&lt;/label>&lt;select name="difficulty" id="difficulty">&lt;option selected value="1">1 star&lt;/option>&lt;option value="2">2 stars&lt;/option>&lt;option value="3">3 stars&lt;/option>&lt;option value="4">4 stars&lt;/option>&lt;option value="5">5 stars&lt;/option>&lt;/select>';
    } else if (diff == '2') {
        document.getElementById('editDifficulty').innerHTML = '&lt;label for="difficulty">Difficulty:&lt;/label>&lt;select name="difficulty" id="difficulty">&lt;option value="1">1 star&lt;/option>&lt;option selected value="2">2 stars&lt;/option>&lt;option value="3">3 stars&lt;/option>&lt;option value="4">4 stars&lt;/option>&lt;option value="5">5 stars&lt;/option>&lt;/select>';
    } else if (diff == '3') {
        document.getElementById('editDifficulty').innerHTML = '&lt;label for="difficulty">Difficulty:&lt;/label>&lt;select name="difficulty" id="difficulty">&lt;option value="1">1 star&lt;/option>&lt;option value="2">2 stars&lt;/option>&lt;option selected value="3">3 stars&lt;/option>&lt;option value="4">4 stars&lt;/option>&lt;option value="5">5 stars&lt;/option>&lt;/select>';
    } else if (diff == '4') {
        document.getElementById('editDifficulty').innerHTML = '&lt;label for="difficulty">Difficulty:&lt;/label>&lt;select name="difficulty" id="difficulty">&lt;option value="1">1 star&lt;/option>&lt;option value="2">2 stars&lt;/option>&lt;option value="3">3 stars&lt;/option>&lt;option selected value="4">4 stars&lt;/option>&lt;option value="5">5 stars&lt;/option>&lt;/select>';
    } else {
        document.getElementById('editDifficulty').innerHTML = '&lt;label for="difficulty">Difficulty:&lt;/label>&lt;select name="difficulty" id="difficulty">&lt;option value="1">1 star&lt;/option>&lt;option value="2">2 stars&lt;/option>&lt;option value="3">3 stars&lt;/option>&lt;option value="4">4 stars&lt;/option>&lt;option selected value="5">5 stars&lt;/option>&lt;/select>';
    }

    // EUVIN: Added these so duplicate steps aren't added from previous sessions
    for (let i = 0; i &lt;= numSteps; i++) {
        deleteStep();
    }

    for (let i = 0; i &lt;= numIngredients; i++) {
        deleteIngredient();
    }

    let fillSteps = response.steps;
    for (let i = 0; i &lt; fillSteps.length; i++) {
        appendEStep(fillSteps[i]);
    }

    let fillIngredients = response.ingredients;
    for (let key in fillIngredients) {
        console.log(key);
        appendEIngredient(key, fillIngredients[key]);
    }

    //TODO: figure out a way to store/display image
    imageSrc = recipeObj.image


};

/**
 * 
 * @param {*} event 
 */
const onUpdateRecipe = async (event) => {
    event.preventDefault();
    console.log("SUBMITTED NEW RECIPE");

    const recipeF = document.getElementById("editRecipeForm");
    let formData = new FormData(recipeF);

    // get ingredients from form
    let ingrArr = [];
    let ingrAmountArr = [];
    let stepsArr = [];
    let strTags = formData.get('tags') ? formData.get('tags').replace(/\s+/g, '').split(/[;,.]+/) : [];
    //let tagsArr = strTags.split(',');

    let ingArr = {};
    for (let i = 0; i &lt; numIngredients; i++) {
        ingArr[formData.get('ingredient' + i)] = formData.get('ingredientAmount' + i);
    }
    console.log(ingArr);

    // get steps from form
    for (let i = 0; i &lt; numSteps; i++) {
        stepsArr.push(formData.get('step' + i));
        console.log(formData.get('step' + i));
    }

    // console.log(formData.get('picture'));
    // CREATE NEW RECIPE
    let newRecipe = {
        name: formData.get('name'),
        datePosted: Date.now(),
        image: formData.get('picture'),
        // default to be 'admin' id
        author: userData ? userData._id : "MMAfv3oCQDiL4u10",
        description: formData.get('description'),
        tags: strTags,
        servingSize: formData.get('servingSize'),
        cookTime: formData.get('cookTime'),
        ingredients: ingArr,
        difficulty: formData.get('difficulty'),
        ingredientAmounts: ingrAmountArr,
        steps: stepsArr,
        _id: recipeId
    }
    // console.log(newRecipe);
    // console.log("RECIPE ID AT UPDATERECIPE IS: " + recipeId);
    const updatedRecipe = await updateRecipeById(recipeId, newRecipe);
    //update the userData
    if (userData &amp;&amp; userData.myRecipe) {
        userData.myRecipe = userData.myRecipe.map(function (recipe) {
            if (recipe._id == updatedRecipe._id)
                return updatedRecipe;
            return recipe
        });
        userData.savedRecipe = userData.savedRecipe.filter(function (recipe) {
            if (recipe._id == updatedRecipe._id)
                return updatedRecipe;
            return recipe
        });
    }
    updatedRecipe.author = userData;
    redirectRecipeDetail(updatedRecipe)
    const page = updatedRecipe._id;
    const routeUrl = RECIPE_ROUTE + page
    routerNavigateWrapper(routeUrl)

    // What does this function do overall?
    // ANSWER: This function serves to

};


/* eslint-disable no-unused-vars*/
const appendStep = () => {
    //let d = document.getElementById('steps');
    // d.innerHTML += "&lt;input type='text' id='tst"+ x++ +"'>&lt;br >";
    console.log("append Step");
    var newTextBox = document.createElement("div");
    console.log("add Step")
    newTextBox.innerHTML =
        "&lt;textarea cols='40' rows='4' id='textAreaBox' name='step" + numSteps + "' placeholder='Step #" +
        numSteps +
        "'>&lt;/textarea>";
    document.getElementById("editNewStepId").appendChild(newTextBox);
    numSteps++;

};
/* eslint-enable no-unused-vars*/

/* eslint-disable no-unused-vars*/
const deleteStep = () => {
    console.log("delete Step")
    //newTextBox.classList.add('stepEntry');
    if (document.getElementById("editNewStepId").lastChild != null) {
        document
            .getElementById("editNewStepId")
            .removeChild(document.getElementById("editNewStepId").lastChild);
        numSteps--;
    }
};
/* eslint-disable no-unused-vars*/
const appendIngredient = () => {
    console.log("add Ingredient");
    var newTextBox = document.createElement("div");
    newTextBox.innerHTML =
        "&lt;input type='text' id='newInputBox' name='ingredient" + numIngredients + "' placeholder='ingredient'>";
    document.getElementById("editNewIngredientId").appendChild(newTextBox);

    var newAmountBox = document.createElement("div");
    newAmountBox.innerHTML =
        "&lt;input type='text' id='newInputBox' name='ingredientAmount" + numIngredients + "' placeholder='amount (ie. 5 cups)'>";
    document.getElementById("editNewIngredientAmountId").appendChild(newAmountBox);
    numIngredients++;
};
/* eslint-enable no-unused-vars*/

/* eslint-disable no-unused-vars*/
const deleteIngredient = () => {
    console.log("delete ingredient");
    if (document.getElementById("editNewIngredientId").lastChild != null) {
        numIngredients--;
        document
            .getElementById("editNewIngredientId")
            .removeChild(document.getElementById("editNewIngredientId").lastChild);
        document
            .getElementById("editNewIngredientAmountId")
            .removeChild(
                document.getElementById("editNewIngredientAmountId").lastChild
            );
    }
};

const appendEIngredient = (existingIngredient, existingAmount) => {
    var newTextBox = document.createElement("div");
    newTextBox.innerHTML =
        "&lt;input type='text' id='newInputBox' name='ingredient" + numIngredients + "' placeholder='ingredient' value=" + existingIngredient + ">";
    document.getElementById("editNewIngredientId").appendChild(newTextBox);

    var newAmountBox = document.createElement("div");
    newAmountBox.innerHTML =
        "&lt;input type='text' id='newInputBox' name='ingredientAmount" + numIngredients + "' placeholder='amount' value=" + existingAmount + ">";
    document.getElementById("editNewIngredientAmountId").appendChild(newAmountBox);
    numIngredients++;
};
/* eslint-enable no-unused-vars*/

const appendEStep = (existingStep) => {
    //let d = document.getElementById('steps');
    // d.innerHTML += "&lt;input type='text' id='tst"+ x++ +"'>&lt;br >";
    var newTextBox = document.createElement("div");

    newTextBox.innerHTML =
        "&lt;textarea cols='40' rows='4' id='textAreaBox' name='step" + numSteps + "' placeholder='Step #" +
        numSteps +
        "'>" + existingStep + "&lt;/textarea>";
    document.getElementById("editNewStepId").appendChild(newTextBox);
    numSteps++;

};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Router_Router.html">Router</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bindEscKey">bindEscKey</a></li><li><a href="global.html#bindPopstate">bindPopstate</a></li><li><a href="global.html#bindRecipeCard">bindRecipeCard</a></li><li><a href="global.html#bindUserProfile">bindUserProfile</a></li><li><a href="global.html#clearGlobalUserData">clearGlobalUserData</a></li><li><a href="global.html#createNewUser">createNewUser</a></li><li><a href="global.html#createNodeClone">createNodeClone</a></li><li><a href="global.html#createRecipeCards">createRecipeCards</a></li><li><a href="global.html#deleteRecipe">deleteRecipe</a></li><li><a href="global.html#fetchRecipeById">fetchRecipeById</a></li><li><a href="global.html#fetchRecipeByPage">fetchRecipeByPage</a></li><li><a href="global.html#fetchRecipesByIds">fetchRecipesByIds</a></li><li><a href="global.html#fetchUserById">fetchUserById</a></li><li><a href="global.html#fillOutRecipe">fillOutRecipe</a></li><li><a href="global.html#getAuthor">getAuthor</a></li><li><a href="global.html#getDescription">getDescription</a></li><li><a href="global.html#getImage">getImage</a></li><li><a href="global.html#getIngredients">getIngredients</a></li><li><a href="global.html#getName">getName</a></li><li><a href="global.html#getSteps">getSteps</a></li><li><a href="global.html#getTags">getTags</a></li><li><a href="global.html#getUserData">getUserData</a></li><li><a href="global.html#hasUser">hasUser</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initialRecipeCards">initialRecipeCards</a></li><li><a href="global.html#insertRecipe">insertRecipe</a></li><li><a href="global.html#onSignIn">onSignIn</a></li><li><a href="global.html#onUpdateRecipe">onUpdateRecipe</a></li><li><a href="global.html#populateUserInfoPage">populateUserInfoPage</a></li><li><a href="global.html#redirectRecipeDetail">redirectRecipeDetail</a></li><li><a href="global.html#routerAddCreatePage">routerAddCreatePage</a></li><li><a href="global.html#routerAddEditPage">routerAddEditPage</a></li><li><a href="global.html#searchForKey">searchForKey</a></li><li><a href="global.html#setGlobalUserData">setGlobalUserData</a></li><li><a href="global.html#setupDisqusScript">setupDisqusScript</a></li><li><a href="global.html#signOut">signOut</a></li><li><a href="global.html#submitInitialSearch">submitInitialSearch</a></li><li><a href="global.html#submitSearch">submitSearch</a></li><li><a href="global.html#updateRecipeById">updateRecipeById</a></li><li><a href="global.html#uploadImage">uploadImage</a></li><li><a href="global.html#userSignedOut">userSignedOut</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Thu Dec 09 2021 07:33:18 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
